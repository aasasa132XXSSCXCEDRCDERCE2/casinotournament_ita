<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Blackjack Torneo</title>
<style>
body {
    margin: 0;
    background: #0f5132;
    font-family: Arial, Helvetica, sans-serif;
    color: white;
    text-align: center;
}

/* Tavolo */
#table {
    width: 100vw;
    height: 100vh;
    padding-top: 20px;
}

/* Aree */
.area { margin-bottom: 40px; }

/* Carte */
.card {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 72px;
    height: 102px;
    background: #ffffff;
    border: 1px solid #000;
    border-radius: 6px;
    font-size: 22px;
    margin: 5px;
}
.red { color: #b00000; }
.black { color: #000; }

/* Pulsanti */
button {
    background: #d4af37;
    border: none;
    padding: 12px 26px;
    margin: 6px;
    font-size: 15px;
    cursor: pointer;
}
button:active { opacity: 0.9; }

input {
    width: 80px;
    padding: 5px;
    font-size: 14px;
    text-align: center;
}
</style>
</head>
<body>

<div id="table">
    <div class="area">
        <h3>Dealer</h3>
        <div id="dealerCards"></div>
        <p id="dealerScore"></p>
    </div>

    <div class="area">
        <h3>Giocatore</h3>
        <div id="playerCards"></div>
        <p id="playerScore"></p>
        <p>Mani rimanenti: <span id="handsLeft"></span></p>
        <p>Bankroll: €<span id="bankroll"></span></p>
        <p>Puntata: €<input type="number" id="betInput" value="100" min="1"></p>
    </div>

    <button onclick="hit()">HIT</button>
    <button onclick="stand()">STAND</button>
    <button onclick="doubleBet()">DOUBLE</button>
    <button onclick="split()">SPLIT</button>
</div>

<script>
let deck = [];
let dealer = { cards: [] };
let player = { hands: [], currentHand: 0 };
let bankroll = 5000;
let handsLeft = 30;
let bet = 100;

startHand();

// ------------------- Logica -------------------

function startHand() {
    if(handsLeft <= 0 || bankroll <= 0){
        alert("Torneo finito! Bankroll finale: €" + bankroll);
        return;
    }

    deck = createDeck();
    shuffle(deck);

    dealer.cards = [draw(), draw()];
    player.hands = [[draw(), draw()]];
    player.currentHand = 0;

    bet = parseInt(document.getElementById("betInput").value) || 100;
    render(true);
}

function createDeck(){
    const suits = ["♠","♥","♦","♣"];
    const values = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
    let d = [];
    for(let s of suits)
        for(let v of values)
            d.push({v,s});
    return d;
}

function shuffle(d){
    for(let i=d.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [d[i], d[j]] = [d[j], d[i]];
    }
}

function draw(){ return deck.pop(); }

function score(cards){
    let total=0, aces=0;
    for(let c of cards){
        if(c.v==="A"){ total+=11; aces++; }
        else if(["K","Q","J"].includes(c.v)) total+=10;
        else total+=parseInt(c.v);
    }
    while(total>21 && aces>0){ total-=10; aces--; }
    return total;
}

// ------------------- UI -------------------

function render(hideDealer){
    showCards("dealerCards", dealer.cards, hideDealer);

    const hand = player.hands[player.currentHand];
    showCards("playerCards", hand);
    document.getElementById("playerScore").innerText = "Totale: " + score(hand);

    document.getElementById("bankroll").innerText = bankroll;
    document.getElementById("handsLeft").innerText = handsLeft;
}

function showCards(id, cards, hide=false){
    const div = document.getElementById(id);
    div.innerHTML = "";
    cards.forEach((c,i)=>{
        const el = document.createElement("div");
        el.className = "card " + (["♥","♦"].includes(c.s) ? "red" : "black");
        el.innerText = (hide && i===0 && id==="dealerCards") ? "?" : c.v + c.s;
        div.appendChild(el);
    });
}

// ------------------- Azioni -------------------

function hit(){
    const hand = player.hands[player.currentHand];
    hand.push(draw());
    if(score(hand)>21) nextHandOrEnd();
    render(true);
}

function stand(){
    nextHandOrEnd();
}

function doubleBet(){
    const hand = player.hands[player.currentHand];
    if(bankroll >= bet){
        bankroll -= bet; // paga metà puntata extra
        bet *= 2;
        hand.push(draw());
        nextHandOrEnd();
    } else { alert("Non hai abbastanza soldi per il double"); }
}

function split(){
    const hand = player.hands[player.currentHand];
    if(hand.length===2 && hand[0].v===hand[1].v && bankroll>=bet){
        bankroll -= bet;
        const newHand = [hand.pop(), draw()];
        hand.push(draw());
        player.hands.splice(player.currentHand+1,0,newHand);
        render(true);
    } else { alert("Non puoi splittare"); }
}

// ------------------- Fine mano -------------------

function nextHandOrEnd(){
    player.currentHand++;
    if(player.currentHand>=player.hands.length){
        resolveDealer();
    } else {
        render(true);
    }
}

function resolveDealer(){
    while(score(dealer.cards)<17) dealer.cards.push(draw());

    player.hands.forEach(hand=>{
        const pScore = score(hand);
        const dScore = score(dealer.cards);

        if(pScore>21){ bankroll -= bet; }
        else if(dScore>21 || pScore>dScore){ 
            bankroll += (pScore===21 && hand.length===2) ? Math.round(bet*1.5) : bet;
        }
        else if(pScore<dScore){ bankroll -= bet; }
    });

    handsLeft--;
    setTimeout(startHand, 1000);
}
</script>

</body>
</html>
